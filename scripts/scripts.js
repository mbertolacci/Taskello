"use strict";angular.module("TrelloTasksApp",["ui.bootstrap"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("TrelloTasksApp").directive("fillParentHeight",["$timeout",function(){return function(t,n){var e;return e=function(){var t,e,r;return r=n.parent().offset(),t=n.offset(),e=n.parent().height(),n.css({"max-height":e-(t.top-r.top)})},n.parent().on("resized",e),setTimeout(e)}}]),angular.module("TrelloTasksApp").directive("fillWindowHeight",["$timeout",function(){return function(t,n){var e,r;return e=function(){var t,e,r;return e=n.offset(),r=$(window).height(),t=parseInt(n.css("marginBottom")),n.css({height:r-e.top-t}),n.trigger("resized")},r=function(){return e(),setTimeout(r,1e3)},r(),$(window).on("resize",e)}}]),angular.module("TrelloTasksApp").directive("throttledModel",[function(){return function(t,n,e){var r;return r=_.debounce(function(n){return t.$apply(function(){return t[e.throttledModel]=n})},50),n.on("input",function(){return r(n.val())})}}]),angular.module("TrelloTasksApp").controller("MainCtrl",["$scope","$q","Trello","TrelloTasks",function(t,n,e,r){var a,i;return t.trelloTasks=r,t.isBoardCollapsed=!1,t.isOrganizationCollapsed=!1,t.organizations=e.organizations,t.lists=e.lists,t.boards=e.boards,t.organizationHasMatchingCards=function(n,e){return _.any(n.boards,function(n){return t.boardHasMatchingCards(n,e)})},a=function(t,n){var r;return n.justMe&&-1===_.indexOf(t.idMembers,e.me.id)?!1:(r=n.searchTerms,r&&""!==r&&r.split?_.every(_.toArray(r.split(/\ /g)),function(n){var r,a;return a=RegExp(""+n,"i"),t.name.match(a)?!0:e.lists[t.idList].name.match(a)?!0:e.boards[t.idBoard].name.match(a)?!0:(r=e.boards[t.idBoard].idOrganization||"my",e.organizations[r].displayName.match(a)?!0:!1)}):!0)},i=function(t,n){return _.any(t,function(t){return a(t,n)})},t.boardHasMatchingCards=function(t,n){return i(t.cards,n)},t.listHasMatchingCards=function(t,n){return i(t.cards,n)},t.cardMatches=a}])}.call(this),function(){angular.module("TrelloTasksApp").directive("sortable",[function(){return{require:"?ngModel",link:function(t,n,e,r){var a,i;return i=angular.extend({},t.$eval(e.sortable)),r.$render=function(){return n.sortable("refresh")},a=!1,n.sortable(i).on("sortstart",function(t,n){var e;return n.item.model||(e=$(n.helper).data("model"),e&&(n.item.model=e,n.item.fromElsewhere=!0)),n.item.model?void 0:n.item.model=r.$modelValue[n.item.index()]}).on("sortstop",function(n,e){var a,i,o;if(o=$(e.item).data("dropped"),e.item.model)if(a=_.indexOf(r.$modelValue,e.item.model),i=e.item.index(),o)r.$modelValue.splice(a,1);else{if(a===i)return;-1!==a&&r.$modelValue.splice(a,1),r.$modelValue.splice(i,0,e.item.model)}return $(e.item).remove(),t.$apply()})}}}]),angular.module("TrelloTasksApp").directive("draggable",[function(){return{require:"?ngModel",link:function(t,n,e,r){var a;return a=angular.extend({},t.$eval(e.draggable)),n.draggable(a).on("dragstart",function(t,n){return $(n.helper).data("model",r.$modelValue)})}}}]),angular.module("TrelloTasksApp").directive("droppable",[function(){return{link:function(t,n,e){var r;return r=angular.extend({},t.$eval(e.droppable)),n.droppable(r).on("drop",function(t,n){return $(n.draggable).data("dropped",!0)})}}}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("angularBurn",["$rootScope","$q","$timeout",function(n,e,r){var a,i;return a=function(i,o){var u,l,c,s,d,f,g,p;return null==o&&(o=[]),l=e.defer(),u=l.promise,p=null,c=null,s=null,g=function(t){return p||(p=angular.copy(o),l.resolve(p)),t.val()&&angular.copy(t.val(),p),c=angular.copy(p)},d=function(){var t;return i.on("value",function(t){return r(function(){return g(t)})}),t=!0,s=n.$watch(function(){var n;return t?(t=!1,void 0):(n=JSON.parse(angular.toJson(p)),angular.equals(c,n)?void 0:i.set(n))})},f=function(){return"function"==typeof s&&s(),i.off("value")},angular.extend(u,{_reference:i,authClient:function(e){return new FirebaseAuthClient(i,function(){var r;return r=arguments.length>=1?t.call(arguments,0):[],n.$eval(function(){return e.apply(null,r)})})},child:function(t,n){var e;return e=i.child(t),a(e,n)},watch:d,stopWatching:f}),u},i={},i.client=function(t,n){var e;return e=new Firebase(t),a(e,n)},i}])}.call(this),function(){angular.module("TrelloTasksApp").factory("Tasks",["$window","$rootScope","$timeout","$q","makeEventEmitter","angularBurn",function(t,n,e,r,a,i){var o,u,l,c,s,d,f;return c=a({}),l=r.defer(),f=r.defer(),c.user=null,c.authenticationState="unknown",c.lastAuthenticationError={},u=i.client("https://trellotasks.firebaseio.com/users"),o=u.authClient(function(t,n){return n?(c.user=n,c.authenticationState="authenticated",angular.copy({},c.lastAuthenticationError),c.trigger("authenticated")):(c.user=null,c.authenticationState="unauthenticated",angular.copy(t,c.lastAuthenticationError),c.trigger("unauthenticated",t))}),s=null,d=null,c.on("authenticated",function(){return s||(s=u.child(""+c.user.id+"/tasks",[]),l.resolve(s),d=u.child(""+c.user.id+"/trelloAccount",{}),f.resolve(d)),s.watch(),d.watch()}),c.on("unauthenticated",function(){return null!=s&&s.stopWatching(),null!=d?d.stopWatching():void 0}),c.getTaskCards=function(){return l.promise},c.getTrelloToken=function(){return f.promise.then(function(t){return t.apiToken})},c.setTrelloToken=function(t){return f.promise.then(function(n){return n.apiToken=t})},c.logout=function(){return null!=s&&s.stopWatching(),null!=d&&d.stopWatching(),o.logout()},c.login=function(t){return o.login("password",{email:t.email,password:t.password})},c.createUser=function(t){var e;return e=r.defer(),o.createUser(t.email,t.password,function(r){return r?(e.reject(),n.$apply(function(){return angular.copy(r,c.lastAuthenticationError)})):(c.login(t),e.resolve())}),e.promise},c}]),angular.module("TrelloTasksApp").factory("TrelloTasks",["$timeout","$rootScope","makeEventEmitter","Trello","Tasks",function(t,n,e,r,a){var i,o;return i=e({}),i.authenticationState="unknown",i.lastAuthenticationError=a.lastAuthenticationError,o=function(){return i.user=a.user,i.authenticationState="unknown"===a.authenticationState?"unknown":"authenticated"!==a.authenticationState?i.authenticating?"authenticating":"unauthenticated":r.authorized?"authenticated":i.authenticating?"authenticating":"needTrello"},r.on("unauthenticated",o),a.on("unauthenticated",o),r.on("authenticated",function(){return a.setTrelloToken(r.getApiToken()),o()}),a.on("authenticated",function(){return i.authenticating=!0,a.getTrelloToken().then(function(t){return t?(i.authenticating=!0,r.authorize(t).then(function(){return i.authenticating=!1},function(){return i.authenticating=!1})):i.authenticating=!1,o()}),o()}),o(),i.taskCards=a.getTaskCards(),r.on("cards-updated",function(t){return i.taskCards.then(function(n){var e,r;return e={},_.each(t,function(t){var r;return r=_.findWhere(n,{id:t.id}),r?(angular.copy(t,r),e[r.id]=!0):void 0}),r=_.filter(n,function(t){return e[t.id]}),angular.copy(r,n)})}),i.taskCards.then(function(t){return i.inTaskList=function(n){return!!_.findWhere(t,{id:n.id})}}),i.createUser=function(t,n){return i.creatingUser=!0,a.createUser({email:t,password:n}).then(function(){return i.creatingUser=!1},function(){return i.creatingUser=!1})},i.signIn=function(t,n){return i.authenticating=!0,a.login({email:t,password:n})},i.signOut=function(){return a.logout()},i.connectTrello=function(){return r.authorize()},i}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("makeEventEmitter",["$rootScope","$timeout",function(n,e){return function(n){var r;return r={},n.on=function(t,n){var e;return null==(e=r[t])&&(r[t]=[]),r[t].push(n)},n.trigger=function(){var n,a;return a=arguments[0],n=arguments.length>=2?t.call(arguments,1):[],angular.forEach(r[a]||[],function(t){return e(function(){return t.apply(null,n)})})},n}}]),angular.module("TrelloTasksApp").factory("Trello",["$rootScope","$timeout","$q","makeEventEmitter",function(n,e,r,a){var i,o,u,l,c,s,d;return d=a({}),d.authorized=!1,n.$watch(function(){return console.log("digested")}),o=function(){var e,a,i,o,u;return o=arguments[0],e=arguments.length>=2?t.call(arguments,1):[],i={},u=!0,_.isObject(e[0])?(i=e[0],u=e[1]===!1?!1:!0):u=e[0]===!1?!1:!0,a=r.defer(),Trello.get(o,i,function(t){return u?n.$apply(function(){return a.resolve(t)}):a.resolve(t)},function(t){return u?n.$apply(function(){return a.reject(t)}):a.reject(t)}),a.promise},d.authorize=function(t){var n;return t&&Trello.setToken(t),n=r.defer(),Trello.authorize({name:"Taskello",type:"popup",interactive:!t,persist:!1,success:function(){return e(function(){return d.authorized=!0,d.trigger("authenticated"),n.resolve(!0)})},error:function(){return e(function(){return d.trigger("unauthenticated"),n.reject(!0)})}}),n.promise},d.getApiToken=function(){return Trello.token()},d.me={},d.organizations={my:{displayName:"My Boards"}},d.boards={},d.lists={},d.cards={},u=function(t,n){return t===n?n:(angular.forEach(t,function(t,e){return"$"!==("function"==typeof e.charAt?e.charAt(0):void 0)?_.isObject(t)&&_.isObject(n[e])||_.isArray(t)&&_.isArray(n[e])?u(t,n[e]):n[e]!==t?n[e]=t:void 0:void 0}),_.isArray(n)&&_.isArray(t)?n.length=t.length:angular.forEach(n,function(e,r){return"$"!==("function"==typeof r.charAt?r.charAt(0):void 0)?_.isUndefined(t[r])?delete n[r]:void 0:void 0}),n)},i=!0,l=function(){var t,n,e,a,l,c;return c=!1,i?(l=d.organizations,t=d.boards,n=d.cards,e=d.lists,a=d.me,i=!1,c=!0):(l={my:{displayName:"My Boards"}},t={},n={},e={},a={}),r.all([o("member/me/boards",{lists:"open"},c),o("member/me/organizations",c),o("member/me",c)]).then(function(i){var u,s,d;return u=i[0],d=i[1],s=i[2],angular.copy(s,a),_.each(d,function(t){return l[t.id]=t}),r.all(_.map(u,function(r){var a,i;return r.idOrganization&&l[r.idOrganization]||(r.idOrganization="my"),null==(i=(a=l[r.idOrganization]).boards)&&(a.boards=[]),l[r.idOrganization].boards.push(r),t[r.id]=r,_.each(r.lists,function(t){return e[t.id]=t}),o("board/"+r.id+"/cards",c).then(function(t){return r.cards=t,_.each(t,function(t){var r,a;return null==(a=(r=e[t.idList]).cards)&&(r.cards=[]),e[t.idList].cards.push(t),n[t.id]=t})})}))}).then(function(){return u(l,d.organizations),u(t,d.boards),u(n,d.cards),u(e,d.lists),u(a,d.me),d.trigger("cards-updated",d.cards),d.trigger("lists-updated",d.lists),d.trigger("boards-updated",d.boards),d.trigger("organizations-updated",d.organizations)})},s=null,c=function(){return l().then(function(){return s=e(c,3e4)})},d.on("authenticated",c),d.on("unauthenticated",function(){return null!=s?s.cancel():void 0}),d}])}.call(this);