"use strict";angular.module("TrelloTasksApp",["ui.bootstrap"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("TrelloTasksApp").directive("fillParentHeight",["$timeout",function(t){return function(n,r){var e;return e=function(){var t,n,e;return e=r.parent().offset(),t=r.offset(),n=r.parent().height(),r.css({"max-height":n-(t.top-e.top)})},r.parent().on("resized",e),t(e)}}]),angular.module("TrelloTasksApp").directive("fillWindowHeight",["$timeout",function(t){return function(n,r){var e,a;return e=function(){var t,n,e;return n=r.offset(),e=$(window).height(),t=parseInt(r.css("marginBottom")),r.css({height:e-n.top-t}),r.trigger("resized")},a=function(){return e(),t(a,1e3)},a(),$(window).on("resize",e)}}]),angular.module("TrelloTasksApp").directive("throttledModel",[function(){return function(t,n,r){var e;return e=_.debounce(function(n){return t.$apply(function(){return t[r.throttledModel]=n})},50),n.on("input",function(){return e(n.val())})}}]),angular.module("TrelloTasksApp").controller("MainCtrl",["$scope","$q","Trello","TrelloTasks",function(t,n,r,e){var a,i;return t.trelloTasks=e,t.isBoardCollapsed=!1,t.isOrganizationCollapsed=!1,t.organizations=r.organizations,t.lists=r.lists,t.boards=r.boards,t.organizationHasMatchingCards=function(n,r){return _.any(n.boards,function(n){return t.boardHasMatchingCards(n,r)})},a=function(t,n){return n&&""!==n&&n.split?_.every(_.toArray(n.split(/\ /g)),function(n){var e,a;return a=RegExp(""+n,"i"),t.name.match(a)?!0:r.lists[t.idList].name.match(a)?!0:r.boards[t.idBoard].name.match(a)?!0:(e=r.boards[t.idBoard].idOrganization||"my",r.organizations[e].displayName.match(a)?!0:!1)}):!0},i=function(t,n){return _.any(t,function(t){return a(t,n)})},t.boardHasMatchingCards=function(t,n){return i(t.cards,n)},t.listHasMatchingCards=function(t,n){return i(t.cards,n)},t.cardMatches=a}])}.call(this),function(){angular.module("TrelloTasksApp").directive("sortable",[function(){return{require:"?ngModel",link:function(t,n,r,e){var a,i;return i=angular.extend({},t.$eval(r.sortable)),e.$render=function(){return n.sortable("refresh")},a=!1,n.sortable(i).on("sortstart",function(t,n){var r;return n.item.model||(r=$(n.helper).data("model"),r&&(n.item.model=r,n.item.fromElsewhere=!0)),n.item.model?void 0:n.item.model=e.$modelValue[n.item.index()]}).on("sortstop",function(n,r){var a,i,o;if(o=$(r.item).data("dropped"),r.item.model)if(a=_.indexOf(e.$modelValue,r.item.model),i=r.item.index(),o)e.$modelValue.splice(a,1);else{if(a===i)return;-1!==a&&e.$modelValue.splice(a,1),e.$modelValue.splice(i,0,r.item.model)}return $(r.item).remove(),t.$apply()})}}}]),angular.module("TrelloTasksApp").directive("draggable",[function(){return{require:"?ngModel",link:function(t,n,r,e){var a;return a=angular.extend({},t.$eval(r.draggable)),n.draggable(a).on("dragstart",function(t,n){return $(n.helper).data("model",e.$modelValue)})}}}]),angular.module("TrelloTasksApp").directive("droppable",[function(){return{link:function(t,n,r){var e;return e=angular.extend({},t.$eval(r.droppable)),n.droppable(e).on("drop",function(t,n){return $(n.draggable).data("dropped",!0)})}}}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("angularBurn",["$rootScope","$q","$timeout",function(n,r,e){var a,i;return a=function(i,o){var u,l,c,s,d,f,g,p;return null==o&&(o=[]),l=r.defer(),u=l.promise,p=null,c=null,s=null,g=function(t){return p||(p=angular.copy(o),l.resolve(p)),t.val()&&angular.copy(t.val(),p),c=angular.copy(p)},d=function(){var t;return i.on("value",function(t){return e(function(){return g(t)})}),t=!0,s=n.$watch(function(){var n;return t?(t=!1,void 0):(n=JSON.parse(angular.toJson(p)),angular.equals(c,n)?void 0:i.set(n))})},f=function(){return"function"==typeof s&&s(),i.off("value")},angular.extend(u,{_reference:i,authClient:function(r){return new FirebaseAuthClient(i,function(){var e;return e=arguments.length>=1?t.call(arguments,0):[],n.$eval(function(){return r.apply(null,e)})})},child:function(t,n){var r;return r=i.child(t),a(r,n)},watch:d,stopWatching:f}),u},i={},i.client=function(t,n){var r;return r=new Firebase(t),a(r,n)},i}])}.call(this),function(){angular.module("TrelloTasksApp").factory("Tasks",["$window","$rootScope","$timeout","$q","makeEventEmitter","angularBurn",function(t,n,r,e,a,i){var o,u,l,c,s,d,f;return c=a({}),l=e.defer(),f=e.defer(),c.user=null,c.authenticationState="unknown",c.lastAuthenticationError={},u=i.client("https://trellotasks.firebaseio.com/users"),o=u.authClient(function(t,n){return n?(c.user=n,c.authenticationState="authenticated",angular.copy({},c.lastAuthenticationError),c.trigger("authenticated")):(c.user=null,c.authenticationState="unauthenticated",angular.copy(t,c.lastAuthenticationError),c.trigger("unauthenticated",t))}),s=null,d=null,c.on("authenticated",function(){return s||(s=u.child(""+c.user.id+"/tasks",[]),l.resolve(s),d=u.child(""+c.user.id+"/trelloAccount",{}),f.resolve(d)),s.watch(),d.watch()}),c.on("unauthenticated",function(){return null!=s&&s.stopWatching(),null!=d?d.stopWatching():void 0}),c.getTaskCards=function(){return l.promise},c.getTrelloToken=function(){return f.promise.then(function(t){return t.apiToken})},c.setTrelloToken=function(t){return f.promise.then(function(n){return n.apiToken=t})},c.logout=function(){return null!=s&&s.stopWatching(),null!=d&&d.stopWatching(),o.logout()},c.login=function(t){return o.login("password",{email:t.email,password:t.password})},c.createUser=function(t){var r;return r=e.defer(),o.createUser(t.email,t.password,function(e){return e?(r.reject(),n.$apply(function(){return angular.copy(e,c.lastAuthenticationError)})):(c.login(t),r.resolve())}),r.promise},c}]),angular.module("TrelloTasksApp").factory("TrelloTasks",["$timeout","$rootScope","makeEventEmitter","Trello","Tasks",function(t,n,r,e,a){var i,o;return i=r({}),i.authenticationState="unknown",i.lastAuthenticationError=a.lastAuthenticationError,o=function(){return i.user=a.user,i.authenticationState="unknown"===a.authenticationState?"unknown":"authenticated"!==a.authenticationState?i.authenticating?"authenticating":"unauthenticated":e.authorized?"authenticated":i.authenticating?"authenticating":"needTrello"},e.on("unauthenticated",o),a.on("unauthenticated",o),e.on("authenticated",function(){return a.setTrelloToken(e.getApiToken()),o()}),a.on("authenticated",function(){return i.authenticating=!0,a.getTrelloToken().then(function(t){return t?(i.authenticating=!0,e.authorize(t).then(function(){return i.authenticating=!1},function(){return i.authenticating=!1})):i.authenticating=!1,o()}),o()}),o(),i.taskCards=a.getTaskCards(),e.on("cards-updated",function(t){return i.taskCards.then(function(n){var r,e;return r={},_.each(t,function(t){var e;return e=_.findWhere(n,{id:t.id}),e?(angular.copy(t,e),r[e.id]=!0):void 0}),e=_.filter(n,function(t){return r[t.id]}),angular.copy(e,n)})}),i.createUser=function(t,n){return i.creatingUser=!0,a.createUser({email:t,password:n}).then(function(){return i.creatingUser=!1},function(){return i.creatingUser=!1})},i.signIn=function(t,n){return i.authenticating=!0,a.login({email:t,password:n})},i.signOut=function(){return a.logout()},i.connectTrello=function(){return e.authorize()},i}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("makeEventEmitter",["$rootScope","$timeout",function(n,r){return function(n){var e;return e={},n.on=function(t,n){var r;return null==(r=e[t])&&(e[t]=[]),e[t].push(n)},n.trigger=function(){var n,a;return a=arguments[0],n=arguments.length>=2?t.call(arguments,1):[],angular.forEach(e[a]||[],function(t){return r(function(){return t.apply(null,n)})})},n}}]),angular.module("TrelloTasksApp").factory("Trello",["$rootScope","$timeout","$q","makeEventEmitter",function(t,n,r,e){var a,i,o,u,l,c,s;return s=e({}),s.authorized=!1,i=function(n,e){var a;return null==e&&(e={}),a=r.defer(),Trello.get(n,e,function(n){return t.$apply(function(){return a.resolve(n)})},function(n){return t.$apply(function(){return a.reject(n)})}),a.promise},s.authorize=function(t){var e;return t&&Trello.setToken(t),e=r.defer(),Trello.authorize({name:"Taskello",type:"popup",interactive:!t,persist:!1,success:function(){return n(function(){return s.authorized=!0,s.trigger("authenticated"),e.resolve(!0)})},error:function(){return n(function(){return s.trigger("unauthenticated"),e.reject(!0)})}}),e.promise},s.getApiToken=function(){return Trello.token()},s.organizations={my:{displayName:"My Boards"}},s.boards={},s.lists={},s.cards={},o=function(t,n){return t===n?n:(angular.forEach(t,function(t,r){return"$"!==("function"==typeof r.charAt?r.charAt(0):void 0)?_.isObject(t)&&_.isObject(n[r])||_.isArray(t)&&_.isArray(n[r])?o(t,n[r]):n[r]!==t?n[r]=t:void 0:void 0}),_.isArray(n)&&_.isArray(t)?n.length=t.length:angular.forEach(n,function(r,e){return"$"!==("function"==typeof e.charAt?e.charAt(0):void 0)?_.isUndefined(t[e])?delete n[e]:void 0:void 0}),n)},a=!0,u=function(){var t,n,e,u;return a?(u=s.organizations,t=s.boards,n=s.cards,e=s.lists,a=!1):(u={my:{displayName:"My Boards"}},t={},n={},e={}),r.all([i("member/me/boards",{lists:"open"}),i("member/me/organizations")]).then(function(a){var o,l;return o=a[0],l=a[1],_.each(l,function(t){return u[t.id]=t}),r.all(_.map(o,function(r){var a,o;return r.idOrganization&&u[r.idOrganization]||(r.idOrganization="my"),null==(o=(a=u[r.idOrganization]).boards)&&(a.boards=[]),u[r.idOrganization].boards.push(r),t[r.id]=r,_.each(r.lists,function(t){return e[t.id]=t}),i("board/"+r.id+"/cards").then(function(t){return r.cards=t,_.each(t,function(t){var r,a;return null==(a=(r=e[t.idList]).cards)&&(r.cards=[]),e[t.idList].cards.push(t),n[t.id]=t})})}))}).then(function(){return o(u,s.organizations),o(t,s.boards),o(n,s.cards),o(e,s.lists),s.trigger("cards-updated",s.cards),s.trigger("lists-updated",s.lists),s.trigger("boards-updated",s.boards),s.trigger("organizations-updated",s.organizations)})},c=null,l=function(){return u().then(function(){return c=n(l,1e4)})},s.on("authenticated",l),s.on("unauthenticated",function(){return null!=c?c.cancel():void 0}),s}])}.call(this);