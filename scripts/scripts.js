"use strict";angular.module("TrelloTasksApp",["ui.bootstrap"]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),function(){angular.module("TrelloTasksApp").directive("fillParentHeight",["$timeout",function(t){return function(n,r){var e;return e=function(){var t,n,e;return e=r.parent().offset(),t=r.offset(),n=r.parent().height(),r.css({"max-height":n-(t.top-e.top)})},r.parent().on("resized",e),t(e)}}]),angular.module("TrelloTasksApp").directive("fillWindowHeight",["$timeout",function(t){return function(n,r){var e;return e=function(){var t,n,e;return n=r.offset(),e=$(window).height(),t=parseInt(r.css("marginBottom")),r.css({height:e-n.top-t}),r.trigger("resized")},$(window).on("resize",e),t(e)}}]),angular.module("TrelloTasksApp").directive("throttledModel",[function(){return function(t,n,r){var e;return e=_.debounce(function(n){return t.$apply(function(){return t[r.throttledModel]=n})},50),n.on("input",function(){return e(n.val())})}}]),angular.module("TrelloTasksApp").controller("MainCtrl",["$scope","$q","Trello","TrelloTasks",function(t,n,r,e){var a,o;return t.trelloTasks=e,t.isBoardCollapsed=!1,t.isOrganizationCollapsed=!1,t.organizations=r.organizations,t.lists=r.lists,t.boards=r.boards,t.organizationHasMatchingCards=function(n,r){return _.any(n.boards,function(n){return t.boardHasMatchingCards(n,r)})},a=function(t,n){return n&&""!==n&&n.split?_.every(_.toArray(n.split(/\ /g)),function(n){var e,a;return a=RegExp(""+n,"i"),t.name.match(a)?!0:r.lists[t.idList].name.match(a)?!0:r.boards[t.idBoard].name.match(a)?!0:(e=r.boards[t.idBoard].idOrganization||"my",r.organizations[e].displayName.match(a)?!0:!1)}):!0},o=function(t,n){return _.any(t,function(t){return a(t,n)})},t.boardHasMatchingCards=function(t,n){return o(t.cards,n)},t.listHasMatchingCards=function(t,n){return o(t.cards,n)},t.cardMatches=a}])}.call(this),function(){angular.module("TrelloTasksApp").directive("sortable",[function(){return{require:"?ngModel",link:function(t,n,r,e){var a,o;return o=angular.extend({},t.$eval(r.sortable)),e.$render=function(){return n.sortable("refresh")},a=!1,n.sortable(o).on("sortstart",function(t,n){var r;return n.item.model||(r=$(n.helper).data("model"),r&&(n.item.model=r,n.item.fromElsewhere=!0)),n.item.model?void 0:n.item.model=e.$modelValue[n.item.index()]}).on("sortstop",function(n,r){var a,o,i;if(i=$(r.item).data("dropped"),r.item.model)if(a=_.indexOf(e.$modelValue,r.item.model),o=r.item.index(),i)e.$modelValue.splice(a,1);else{if(a===o)return;-1!==a&&e.$modelValue.splice(a,1),e.$modelValue.splice(o,0,r.item.model)}return $(r.item).remove(),t.$apply()})}}}]),angular.module("TrelloTasksApp").directive("draggable",[function(){return{require:"?ngModel",link:function(t,n,r,e){var a;return a=angular.extend({},t.$eval(r.draggable)),n.draggable(a).on("dragstart",function(t,n){return $(n.helper).data("model",e.$modelValue)})}}}]),angular.module("TrelloTasksApp").directive("droppable",[function(){return{link:function(t,n,r){var e;return e=angular.extend({},t.$eval(r.droppable)),n.droppable(e).on("drop",function(t,n){return $(n.draggable).data("dropped",!0)})}}}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("angularBurn",["$rootScope","$q","$timeout",function(n,r,e){var a,o;return a=function(o,i){var u,l,c,s,d,f,g,p;return null==i&&(i=[]),l=r.defer(),u=l.promise,p=null,c=null,s=null,g=function(t){return p||(p=angular.copy(i),l.resolve(p)),t.val()&&angular.copy(t.val(),p),c=angular.copy(p)},d=function(){var t;return o.on("value",function(t){return e(function(){return g(t)})}),t=!0,s=n.$watch(function(){var n;return t?(t=!1,void 0):(n=JSON.parse(angular.toJson(p)),angular.equals(c,n)?void 0:o.set(n))})},f=function(){return"function"==typeof s&&s(),o.off("value")},angular.extend(u,{_reference:o,authClient:function(r){return new FirebaseAuthClient(o,function(){var e;return e=arguments.length>=1?t.call(arguments,0):[],n.$eval(function(){return r.apply(null,e)})})},child:function(t,n){var r;return r=o.child(t),a(r,n)},watch:d,stopWatching:f}),u},o={},o.client=function(t,n){var r;return r=new Firebase(t),a(r,n)},o}])}.call(this),function(){angular.module("TrelloTasksApp").factory("Tasks",["$window","$rootScope","$timeout","$q","makeEventEmitter","angularBurn",function(t,n,r,e,a,o){var i,u,l,c,s,d,f;return c=a({}),l=e.defer(),f=e.defer(),c.user=null,c.authenticationState="unknown",c.lastAuthenticationError={},u=o.client("https://trellotasks.firebaseio.com/users"),i=u.authClient(function(t,n){return n?(c.user=n,c.authenticationState="authenticated",angular.copy({},c.lastAuthenticationError),c.trigger("authenticated")):(c.user=null,c.authenticationState="unauthenticated",angular.copy(t,c.lastAuthenticationError),c.trigger("unauthenticated",t))}),s=null,d=null,c.on("authenticated",function(){return s||(s=u.child(""+c.user.id+"/tasks",[]),l.resolve(s),d=u.child(""+c.user.id+"/trelloAccount",{}),f.resolve(d)),s.watch(),d.watch()}),c.on("unauthenticated",function(){return null!=s&&s.stopWatching(),null!=d?d.stopWatching():void 0}),c.getTaskCards=function(){return l.promise},c.getTrelloToken=function(){return f.promise.then(function(t){return t.apiToken})},c.setTrelloToken=function(t){return f.promise.then(function(n){return n.apiToken=t})},c.logout=function(){return null!=s&&s.stopWatching(),null!=d&&d.stopWatching(),i.logout()},c.login=function(t){return i.login("password",{email:t.email,password:t.password})},c.createUser=function(t){var r;return r=e.defer(),i.createUser(t.email,t.password,function(e){return e?(r.reject(),n.$apply(function(){return angular.copy(e,c.lastAuthenticationError)})):(c.login(t),r.resolve())}),r.promise},c}]),angular.module("TrelloTasksApp").factory("TrelloTasks",["$timeout","$rootScope","makeEventEmitter","Trello","Tasks",function(t,n,r,e,a){var o,i;return o=r({}),o.authenticationState="unknown",o.lastAuthenticationError=a.lastAuthenticationError,i=function(){return o.user=a.user,o.authenticationState="unknown"===a.authenticationState?"unknown":"authenticated"!==a.authenticationState?o.authenticating?"authenticating":"unauthenticated":e.authorized?"authenticated":o.authenticating?"authenticating":"needTrello"},e.on("unauthenticated",i),a.on("unauthenticated",i),e.on("authenticated",function(){return a.setTrelloToken(e.getApiToken()),i()}),a.on("authenticated",function(){return o.authenticating=!0,a.getTrelloToken().then(function(t){return t?(o.authenticating=!0,e.authorize(t).then(function(){return o.authenticating=!1},function(){return o.authenticating=!1})):o.authenticating=!1,i()}),i()}),i(),o.taskCards=a.getTaskCards(),e.on("cards-updated",function(t){return o.taskCards.then(function(n){var r,e;return r={},_.each(t,function(t){var e;return e=_.findWhere(n,{id:t.id}),e?(angular.copy(t,e),r[e.id]=!0):void 0}),e=_.filter(n,function(t){return r[t.id]}),angular.copy(e,n)})}),o.createUser=function(t,n){return o.creatingUser=!0,a.createUser({email:t,password:n}).then(function(){return o.creatingUser=!1},function(){return o.creatingUser=!1})},o.signIn=function(t,n){return o.authenticating=!0,a.login({email:t,password:n})},o.signOut=function(){return a.logout()},o.connectTrello=function(){return e.authorize()},o}])}.call(this),function(){var t=[].slice;angular.module("TrelloTasksApp").factory("makeEventEmitter",["$rootScope","$timeout",function(n,r){return function(n){var e;return e={},n.on=function(t,n){var r;return null==(r=e[t])&&(e[t]=[]),e[t].push(n)},n.trigger=function(){var n,a;return a=arguments[0],n=arguments.length>=2?t.call(arguments,1):[],angular.forEach(e[a]||[],function(t){return r(function(){return t.apply(null,n)})})},n}}]),angular.module("TrelloTasksApp").factory("Trello",["$rootScope","$timeout","$q","makeEventEmitter",function(t,n,r,e){var a,o;return o=e({}),o.authorized=!1,a=function(n,e){var a;return null==e&&(e={}),a=r.defer(),Trello.get(n,e,function(n){return t.$apply(function(){return a.resolve(n)})},function(n){return t.$apply(function(){return a.reject(n)})}),a.promise},o.authorize=function(t){var e;return t&&Trello.setToken(t),e=r.defer(),Trello.authorize({name:"Taskello",type:"popup",interactive:!t,persist:!1,success:function(){return n(function(){return o.authorized=!0,o.trigger("authenticated"),e.resolve(!0)})},error:function(){return n(function(){return o.trigger("unauthenticated"),e.reject(!0)})}}),e.promise},o.getApiToken=function(){return Trello.token()},o.organizations={my:{displayName:"My Boards"}},o.boards={},o.lists={},o.cards={},o.on("authenticated",function(){return r.all([a("member/me/boards",{lists:"open"}),a("member/me/organizations")]).then(function(t){var n,e;return n=t[0],e=t[1],_.each(e,function(t){return o.organizations[t.id]=t}),r.all(_.map(n,function(t){var n,r;return t.idOrganization&&o.organizations[t.idOrganization]||(t.idOrganization="my"),null==(r=(n=o.organizations[t.idOrganization]).boards)&&(n.boards=[]),o.organizations[t.idOrganization].boards.push(t),o.boards[t.id]=t,_.each(t.lists,function(t){return o.lists[t.id]=t}),a("board/"+t.id+"/cards").then(function(n){return t.cards=n,_.each(n,function(t){var n,r;return null==(r=(n=o.lists[t.idList]).cards)&&(n.cards=[]),o.lists[t.idList].cards.push(t),o.cards[t.id]=t})})}))}).then(function(){return o.trigger("cards-updated",o.cards),o.trigger("lists-updated",o.lists),o.trigger("boards-updated",o.boards),o.trigger("organizations-updated",o.organizations)})}),o}])}.call(this);